# Cat Voting API Project

## Table of Contents
- [Overview](#overview)
- [Features](#features)
- [Requirements](#requirements)
- [Setup and Installation](#setup-and-installation)
- [Project Structure](#project-structure)
- [Webpage Description](#webpage-description)
- [API Endpoints](#api-endpoints)
- [Testing](#testing)
- [Notes](#notes)
- [Future Works](#future-works)

---

## Overview

The Cat Voting API is a Go-based application built using the Beego framework. It provides functionalities to fetch cat images, search cat details and images by breeds, manage favorites, and perform voting actions for cat images using The Cat API.

---

## Features

- Fetch cat images and breeds.
- Add and remove images from favorites.
- Vote on cat images.
- Display and manage favorite images.
- Automated testing with mocks for HTTP interactions.
- Error handling for configuration and API issues.

---

## Requirements

- Go 1.19+
  - Run `go version` to check if Go is installed in your system. If not, then install it and after that, go forward.
  - In Windows, ensure that **GOROOT** is added in the environment variables.
- Beego v2.3.4
  - Run `bee version` to check if Beego is installed in your system. If not, then install it and after that, go forward.
  - Instructions are provided in the [Beego Setup](#beego-setup) section for Beego Installation.
- The Cat API key (obtain from [The Cat API](https://thecatapi.com/))

---

## Setup and Installation

### Clone the Repository
```bash
git clone https://github.com/srsaurav0/GoLang-Cat-API.git
cd GoLang-Cat-API
```

### Create Virtual Environment
- For Linux:
  ```bash
  python3 -m venv .venv
  source .venv/bin/activate
  ```
- For Windows:
  ```bash
  python -m venv .venv
  Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
  .venv\Scripts\activate
  ```

### Beego Setup
- **For Linux**:
  - Download Beego
    ```bash
    go get github.com/beego/beego/v2@v2.3.4
    go get github.com/beego/bee/v2@latest
    ```
  - Set Path
    ```bash
    go env GOPATH
    export PATH=$PATH:$(go env GOPATH)/bin
    echo 'export PATH=$PATH:$(go env GOPATH)/bin' >> ~/.bashrc
    ```
  - Check if installed successfully
    ```bash
    bee version
    ```
-**For Windows**:
  - Download Beego
    ```bash
    go get github.com/beego/beego/v2@v2.3.4
    go get github.com/beego/bee/v2@latest
    ```
  - Check if installed successfully
    ```bash
    bee version
    ```

### Install Dependencies
```bash
go mod tidy
```

### Configuration (Optional)

Edit the configuration file named `conf/app.conf` with the desired `catapi_key`. Currently an API key is provided for testing purposes.

Replace the current value of `catapi_key` with your API key from The Cat API. The API can be generated by logging in the website.

### Run the Application

Start the server:
```bash
bee run
```

Access the application at [http://localhost:8080](http://localhost:8080).

---

## Project Structure

```plaintext
GoLang-Cat-API/
├── conf/                  # Configuration files
│   └── app.conf           # Main configuration file
├── controllers/           # Beego controllers
│   ├── cat_controller.go  # Handles API requests
│   └── default.go         # Loads the index file
├── main.go                # Entry point of the application
├── models/                # (Optional) Models for data handling
├── routers/               # API route definitions
│   └── router.go          # Route setup
├── static/                # Static files
│   ├── css                # CSS files
│   ├── img                # Static images (Placeholders)
│   └── js                 # JavaScript files
├── tests/                 # Unit tests and mocks
│   ├── controller_test.go # Controller test cases
│   ├── default_test.go    # Default controller test cases
│   └── routers_test.go    # Router test cases
├── views/                 # HTML templates
│   └── index.tpl          # HTML template
├── go.mod                 # Go module definition
├── go.sum                 # Dependency versions
└── README.md              # Project documentation
```

---

## Webpage Description

### Voting
When the http://localhost:8080 is accessed, initially the **Voting** tab is loaded. It uses the /api/cats API for fetching a random cat image. While the fetching of the image is executed, a placeholder gif is used for better user experience.
There are 2 functionalities in this page:
#### Add to Favorites 
When the ***heart button*** is pressed, the displayed image is added to the favorites by using the image-id and sub-id. Meanwhile, another image is fetched. This two activities are done concurrently using the ***Goroutines*** and ***Channels***.
  - To check this functionality, open the ***Inspect*** window and then click on ***Network***. After that, select ***Fetch/XHR*** from the tabs. Finally, refresh the page and observe the changes. Only one API **add-to-favourites**(***http://localhost:8080/api/add-to-favourites***) is called. This happens because two APIs are used concurrently.
#### Voting (Like and Dislike) 
If the ***Like*** or ***Dislike*** button is pressed, then voting for the Image on display is executed. For liking, value 1 is added and, for disliking, value -1 is added. To check *all the votes*, go to the address ***http://localhost:8080/api/votes***. Meanwhile, another image is fetched. This two activities are done concurrently using the ***Goroutines*** and ***Channels***.
  - This functionality can be checked in a similar manner. In the Inspect window, only one API **vote**(***http://localhost:8080/api/vote***) is observed when like or dislike button is pressed.

### Breeds
When the breeds tab is clicked, two APIs are used. One is **breeds** and the other is **cats?breed_id=abys** (initially). This happens because initially the *Abyssinian* breed is loaded for better user experience. The **breeds** api fetches all the breeds which are displayed when the *Search Box* is clicked. If a specific breed is selected from the search suggestions, then the **cats?breed_id** API is called again to load its images and details.
- If correct API key is provided, then more than 10 images can be loaded. Otherwise, 10 images can be viewed at max.
- Images can be changed using the ***slider dots*** or ***buttons***.
- Auto scrolling functionality is implemented. So, images will scroll automatically after 3 seconds. This scrolling stops if the user clicks in the image. After that, the scrolling will continue if the user clicks outside the image.

### Favs
In the favs tab, all the images that have been added to favorites using the sub-id and image-id are displayed. The API **api/get-favourites?sub_id=user-123** is used for this purpose. Once the images are loaded, the user can **delete** any image by clicking the **Remove** button. The API **/api/remove-favourite** is used for this.

---

## API Endpoints

### Fetch Cat Images
**GET** `/api/cats`
- Query Parameters: `breed_id` (optional)

### Fetch Breeds
**GET** `/api/breeds`

### Add to Favorites
**POST** `/api/add-to-favourites`
- Body: `{ "image_id": "<image_id>", "sub_id": "<user_id>" }`

### Get Favorites
**GET** `/api/get-favourites`
- Query Parameters: `sub_id`

### Remove from Favorites
**DELETE** `/api/remove-favourite`
- Query Parameters: `favourite_id`

### Vote
**POST** `/api/vote`
- Body: `{ "image_id": "<image_id>", "sub_id": "<user_id>", "value": <1 | -1> }`

### Get Votes
**GET** `/api/votes`
- Query Parameters: `sub_id`

---

## Testing

### Run Tests

Execute the tests:
```bash
go test ./...
```

### View Test Coverage
Generate a coverage report:
```bash
go test ./... -coverprofile=coverage.out
go tool cover -html=coverage.out -o coverage.html
open coverage.html
```
View total coverage in terminal:
```bash
go tool cover -func=coverage.out | grep total: | awk '{print $3}'
```
Open `coverage.html` in a browser to view detailed coverage.

### Key Test Cases

- **Test Configuration Errors**: Validate missing or invalid configuration keys.
- **Mock API Responses**: Simulate external API calls with mock responses.
- **Error Handling**: Test scenarios where API calls fail or return unexpected results.
- **Success Flows**: Ensure endpoints return the expected data on successful execution.

---

## Notes

- Ensure the `catapi_base_url` and `catapi_key` are correctly configured before running the application.
- Mock HTTP clients are used during testing to avoid hitting The Cat API unnecessarily.

---

## Future Works
- The breeds section can be improved by implementing **Goroutines** and **Channels**.
- Tailwind CSS is implemented using cdn for this project which is not recommended used in production level. It will be handled in future.
- The frontend design can be improved in future.